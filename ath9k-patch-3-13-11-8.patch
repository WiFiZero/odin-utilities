--- debug_original.c	2014-10-28 17:53:54.925029202 +0100
+++ debug.c	2014-10-28 17:52:38.633032407 +0100
@@ -27,6 +27,12 @@
 #define REG_READ_D(_ah, _reg) \
 	ath9k_hw_common(_ah)->ops->read((_ah), (_reg))
 
+//Patch: Added by Fran (required function for the patch)
+static int ath9k_debugfs_open(struct inode *inode, struct file *file)
+{        
+	file->private_data = inode->i_private;
+        return 0;
+}
 
 static ssize_t ath9k_debugfs_read_buf(struct file *file, char __user *user_buf,
 				      size_t count, loff_t *ppos)
@@ -1342,6 +1348,55 @@
 	.llseek = default_llseek,
 };
 
+/*************************** Patch starts here ******* ***************************/
+
+static ssize_t read_file_bssid_extra(struct file *file, char __user *user_buf,
+ size_t count, loff_t *ppos)
+{
+ struct ath_softc *sc = file->private_data;
+ struct ath_common *common = ath9k_hw_common(sc->sc_ah);
+ char buf[32];
+ unsigned int len;
+
+ len = sprintf(buf, "%pM\n", common->bssidmask);
+ return simple_read_from_buffer(user_buf, count, ppos, buf, len);
+}
+
+static ssize_t write_file_bssid_extra(struct file *file, const char __user *user_buf,
+ size_t count, loff_t *ppos)
+{
+ struct ath_softc *sc = file->private_data;
+ struct ath_hw *ah = sc->sc_ah;
+ struct ath_common *common = ath9k_hw_common(ah);
+ char buf[32];
+ u8 macaddr[ETH_ALEN];
+ ssize_t len;
+
+ len = min(count, sizeof(buf) - 1);
+ if (copy_from_user(buf, user_buf, len))
+ return -EFAULT;
+
+ buf[len] = '\0';
+
+ sscanf(buf, "%hhx:%hhx:%hhx:%hhx:%hhx:%hhx", &macaddr[0], &macaddr[1],
+ &macaddr[2], &macaddr[3], &macaddr[4], &macaddr[5]);
+
+ memcpy(common->bssidmask, macaddr, ETH_ALEN);
+ ath_hw_setbssidmask(common);
+
+ return count;
+}
+
+static const struct file_operations fops_bssid_extra = {
+ .read = read_file_bssid_extra,
+ .write = write_file_bssid_extra,
+ .open = ath9k_debugfs_open,
+ .owner = THIS_MODULE,
+ .llseek = default_llseek,
+};
+
+
+/*************************** Patch ends here ************************************/
 static ssize_t read_file_regval(struct file *file, char __user *user_buf,
 			     size_t count, loff_t *ppos)
 {
@@ -1932,6 +1987,9 @@
 			    &sc->sc_ah->config.enable_paprd);
 	debugfs_create_file("regidx", S_IRUSR | S_IWUSR, sc->debug.debugfs_phy,
 			    sc, &fops_regidx);
+	//Patch added debugfs bssid_extra
+	debugfs_create_file("bssid_extra", S_IRUSR | S_IWUSR, sc->debug.debugfs_phy,
+	 		    sc, &fops_bssid_extra);
 	debugfs_create_file("regval", S_IRUSR | S_IWUSR, sc->debug.debugfs_phy,
 			    sc, &fops_regval);
 	debugfs_create_bool("ignore_extcca", S_IRUSR | S_IWUSR,
